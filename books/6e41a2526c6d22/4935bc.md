---
title: "9章"
free: false
---

##  Project Organization and Structure（プロジェクトの構成と構造）

基本構文的なものは一旦8章で終わり
実際にRustのプロジェクトを開始するための知識をこの章では触れていく

### module
`crate`はrustにおけるコードの最小単位
- つまり、rustの「プロジェクト全体」や「ライブラリ」は全て`crate`として扱われる。
&nbsp;
`crate`の中のコードは`module`という単位で整理される。
- フォルダ、サブフォルダの様なもので、コードを昨日ごとに分類・整理できる。
   - `module`にはグローバル変数、関数、構造体、`trait`、別の`module`などを保持することができる。
   - `mod`を用いて明示的に宣言できるGoのパッケージ的な理解（同一ファイルに複数パッケージも持てる）
  
&nbsp;
`crate`の最上位にある`module`が`root module`
- バイナリcrateなら`src/main.rs`
- ライブラリcrateなら`src/lib.rs`
  
&nbsp;
別`module`内の要素にアクセスするには下記のように`use`を使う
- `module`全体ではなく使う関数や定数など要素を指定して持ってくることができる
- 全体を持ってくることもできるが、テストコードなど以外では使う要素だけを明示的に宣言するべきぽい
```Rust
use std::f64::consts::PI;

fn main() {
    println!("{}", PI);
}
```

複数も可能
```Rust
use std::f64::consts::{PI,TAU}
```

###  Creating Modules
**Rustで`module`を作成するときのファイル構造の関係**
tour of Rustの内容は若干古そう、今の推奨は下記っぽい

```Text
src/
└── foo.rs           ← 親モジュール
└── foo/
    └── bar.rs       ← サブモジュール foo::bar
```

- 親モジュールのファイルで`mod foo`の様に宣言
- 子モジュールのファイルで`mod bar`の様に宣言
- 公開したい場合は`pub mod foo`

### Module Hierarchy

モジュールは他のモジュールに依存することができる
- モジュールとサブモジュールの関係を定義するには親モジュールで下記の様に宣言する

```Rust
// main.rs

mod foo;
```

### inline Module

サブモジュールは親モジュールの中にインラインで定義することも可能
特に有用なケースがユニットテスト
- Rustでテストを行うときだけ存在する インラインモジュール を作成します！

`.rs`ファイルの末尾で下記の様にテストを書くのがrust風らしい
```Rust
#[cfg(test)] // テストビルド時のみ有効
mod tests {
    use super::*; // 親モジュールの関数や型をインポート

    #[test]
    fn test_something() {
        assert_eq!(2 + 2, 4);
    }
}

```

### Internal Module Referencing
Rustには`use`で使用できるキーワードがいくつかあり、目的のモジュールに素早くアクセスすることができる

**crate**
- crate は、自分のプロジェクトの「トップ」からスタート。
- main.rs や lib.rs から見た階層で指定する。

```Rust
use crate::utils::math::add;
```

**super** 
- 今いるモジュールの「1つ上」から、別の関数やモジュールを呼びたいときに使う。
- テストモジュール（mod tests）の中などでよく登場。

```Rust
use super::helper;
```

**self**
- 自分の中にあるサブモジュールなどにアクセスしたいときに使う。
- 明示的に「このモジュールの中から見たい」と言いたいときに使える。

```Rust
use self::inner::sub_function;
```

### Exporting
モジュール内のメンバ（関数、構造体など）は、そのモジュールの外からアクセスできない
- 外部からアクセス可能にするには、`pub` キーワードを使って公開する必要がある

`crate`内のメンバーも他の`crate`からはアクセスできない
- 同様に`pub`で公開する必要がある

### Structure Visibility
関数と同様に構造体（`struct`）もモジュールの外に公開したいものを `pub` を使って指定できる
- 各メンバも明示的に公開する必要がある。
```Rust
// SeaCreature struct will be usable outside of our module
pub struct SeaCreature {
    pub animal_type: String,
    pub name: String,
    pub arms: i32,
    pub legs: i32,
    // let's keep our weapon private
    weapon: String,
}
```

完璧にカプセル化したいなら構造体を公開して
- `getter`, `setter`を用意する
```Rust
pub struct User {
    name: String,
    age: u32,
}

impl User {
    pub fn new(name: String, age: u32) -> Self {
        Self { name, age }
    }

    pub fn age(&self) -> u32 {
        self.age
    }
}

```

### Prelude
`std::prelude`はRust が**標準ライブラリの中でよく使うもの**を自動的にインポートしてくれる仕組み
- `use std::vec::Vec;`と書かなくても Vec::new() が使えるのはそのため
- Rust の「書きやすさ」を保ちながら、「明示性」も大事にしている設計らしい

### Your Own Prelude
多くのRustのライブラリは自分自身の`Prelude`モジュールを持っているのが慣習
- 自分がライブラリ作ったら`Prelude`用意すべき、逆に人のライブラリ使う時はPreludeで基本的なものから触れていく

### 第9章・まとめ
長かったチュートリアルは終わりという事で何か作ってみる中で自分の物にしていきたい

下記も参考になりそう
- [Rust API 設計ガイドライン（Guidelines for Writing Rust APIs）](https://rust-lang.github.io/api-guidelines/)
- [プログラミングRust 第2版](https://www.oreilly.co.jp/books/9784873119786/)